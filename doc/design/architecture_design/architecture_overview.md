# 架构设计概述 (Architecture Overview)

## 1. 文档导读

本文档是“旅行信息分享应用”架构设计文档集的总纲。旨在为项目干系人（开发人员、测试人员、运维人员及评估专家）提供系统架构的顶层视图和导航指南。本系列文档遵循经典的 **"4+1" 视图模型**（逻辑视图、开发视图、过程视图、部署视图 + 场景视图），并紧密结合 **领域驱动设计 (DDD)** 的原则进行组织。

通过阅读本文档，你将快速理解本系统架构设计的核心愿景、关键决策背后的权衡（Trade-offs）以及各分册文档的侧重点。

---

## 2. 架构愿景与驱动力

本系统的架构设计并非仅仅为了堆砌技术栈，而是为了在满足功能需求的同时，应对以下核心挑战并达成关键的质量目标：

### 2.1 应对业务复杂性
旅行分享应用不仅仅是一个简单的 CRUD 系统。它涉及**复杂的行程规划逻辑**（如多日活动的自动排序、时间冲突检测、基于地理位置的路线计算）以及高频的**社交互动**。
*   **对策**: 我们坚决采用了 **领域驱动设计 (DDD)**。我们将复杂的业务规则封装在领域层（Domain Layer），利用充血模型（Rich Domain Model）保护业务逻辑的完整性，防止业务规则泄露到控制器或数据库脚本中。

### 2.2 平衡开发效率与长期演进
考虑到课程设计的时间限制，我们需要快速交付；但作为一个具有实用价值的系统，我们不能忽视未来的扩展性（例如从单体转向微服务）。
*   **对策**: 我们选择了 **模块化单体 (Modular Monolith)** 架构。这种风格在物理部署上是单体（单一进程，易于部署、调试、测试），但在逻辑结构上保持了严格的模块边界（限界上下文）。这使得我们既享受了单体架构的开发敏捷性，又避免了传统单体应用常见的“大泥球”式代码腐化，为未来可能的微服务拆分预留了清晰的切分点。

### 2.3 AI 能力的深度集成
不同于传统应用将 AI 作为一个独立的外挂功能，本架构在设计之初就将 AI 视为系统的核心能力之一。
*   **对策**: 我们构建了基于 **RAG (检索增强生成)** 的智能问答链路。数据持久化层被设计为不仅服务于事务性业务，也能高效支持 AI 的上下文检索。通过将 AI 模块作为一个独立的限界上下文 (`app_ai`)，我们实现了传统业务逻辑与概率性 AI 推理逻辑的解耦，同时保证 AI 助手能实时访问最新的行程和社区数据。

---

## 3. 核心设计权衡 (Key Design Trade-offs)

在架构设计过程中，我们做出了以下关键决策，并明确了其背后的权衡：

*   **RESTful API vs GraphQL**
    *   **决策**: 选择成熟的 **RESTful API**。
    *   **理由**: 虽然 GraphQL 在前端数据聚合上更灵活，但 RESTful 配合各限界上下文的独立 API 定义，更能强化模块间的逻辑边界（Context Boundary），且利用 HTTP 缓存机制和 CDN 对静态资源的加速更加成熟和简单。

*   **WebSocket vs 轮询 (Polling)**
    *   **决策**: 对于实时聊天，坚决选择 **WebSocket**。
    *   **理由**: 虽然 WebSocket 引入了有状态连接（Stateful Connections），增加了负载均衡和运维的复杂度（需要 Sticky Sessions 或 Redis 广播），但为了保证即时通讯的低延迟体验和减少服务器无效请求，这是必要的架构成本。

*   **ORM (SQLAlchemy) vs Raw SQL**
    *   **决策**: 选择 **ORM** 配合 **Data Mapper** 模式。
    *   **理由**: 虽然 ORM 相比手写优化 SQL 存在微小的运行时性能损耗，但它换来了巨大的代码可维护性和数据库无关性。更重要的是，Data Mapper 模式允许我们将持久化对象 (PO) 与领域实体 (Entity) 分离，保持了核心业务代码的纯洁性。

---

## 4. 架构视图导航

为了从不同维度全面描述系统，架构文档被拆分为以下六个部分。请根据你的角色和需求选择阅读：

*   **[1. 架构设计原则 (Architecture Principles)](./architecture_design_principles.md)**
    *   *核心内容*: DDD 核心概念、分层架构规范、PO/Entity 分离策略、整体技术栈选型。
    *   *推荐受众*: 架构师、核心开发人员。

*   **[2. 逻辑视图 (Logical View)](./logical_view.md)**
    *   *核心内容*: 系统的静态结构，子系统（限界上下文）的具体划分，核心类、接口的设计及其关系。
    *   *推荐受众*: 后端开发人员、业务分析师。

*   **[3. 场景视图 (Scenario View)](./scenario_view.md)**
    *   *核心内容*: 系统的动态行为，通过关键业务流程（如协同规划、AI 问答）的时序图，展示对象间如何协作。
    *   *推荐受众*: 开发人员、测试人员。

*   **[4. 开发视图 (Development View)](./development_view.md)**
    *   *核心内容*: 代码的物理组织结构，包依赖规范，构建工具，配置管理与测试策略。
    *   *推荐受众*: 刚入职的开发人员（用于快速上手）、配置管理员。

*   **[5. 过程视图 (Process View)](./process_view.md)**
    *   *核心内容*: 运行时的并发模型，线程/进程架构，性能瓶颈分析，AI 流式响应机制。
    *   *推荐受众*: 高级开发人员、运维人员。

*   **[6. 部署视图 (Deployment View)](./deployment_view.md)**
    *   *核心内容*: 基础设施拓扑，物理节点分布，网络协议，Nginx 反向代理配置，安全部署策略。
    *   *推荐受众*: 运维人员、DevOps 工程师。
